[["plotly.html", "Chapter 4 Plotly 4.1 Overview 4.2 Plotly Pipeline 4.3 Plotly Foundations 4.4 Plotly Advanced", " Chapter 4 Plotly 4.1 Overview Plotlyæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å¼€æºäº¤äº’å¼å¯è§†åŒ–æ¡†æ¶ï¼Œå®ƒé€šè¿‡æ„å»ºåŸºäº HTML çš„äº¤äº’å¼å›¾è¡¨æ¥æ˜¾ç¤ºä¿¡æ¯ï¼Œå¯åˆ›å»ºå„ç§å½¢å¼çš„ç²¾ç¾å›¾è¡¨ã€‚Plotlyæä¾›äº†Pythonï¼ŒRï¼ŒMatlabç­‰å¤šç§è¯­è¨€APIï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨è¿™äº›è½¯ä»¶ä¸­è°ƒç”¨Plotlyï¼Œä»è€Œå¿«é€Ÿå®ç°äº¤äº’å¼çš„å¯è§†åŒ–ç»˜å›¾ã€‚ 4.2 Plotly Pipeline ä½¿ç”¨plotly-RåŒ…åˆ¶ä½œçš„å›¾å½¢æ˜¯ç”±JavaScriptåº“plotly.jsæä¾›åº•å±‚æ”¯æŒã€‚plotly-RåŒ…ä¸­çš„æ ¸å¿ƒå‡½æ•°æ˜¯plot_ly()ï¼Œå®ƒè¿æ¥äº†Rä¸jsã€‚æˆ‘ä»¬é¦–å…ˆæ¥å°è¯•ä½¿ç”¨plot_ly()æ¢ç´¢ggplot2ä¸­çš„diamondsæ•°æ®é›†ï¼Œäº†è§£å¦‚ä½•ä½¿ç”¨plotlyå·¥ä½œã€‚ 4.2.1 visualization demo # load packages library(plotly) library(dplyr) library(htmlwidgets) library(htmltools) # load the diamonds dataset from the ggplot2 package data(diamonds, package = &quot;ggplot2&quot;) diamonds ## # A tibble: 53,940 Ã— 10 ## carat cut color clarity depth table price x y z ## &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt; &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 0.23 Ideal E SI2 61.5 55 326 3.95 3.98 2.43 ## 2 0.21 Premium E SI1 59.8 61 326 3.89 3.84 2.31 ## 3 0.23 Good E VS1 56.9 65 327 4.05 4.07 2.31 ## 4 0.29 Premium I VS2 62.4 58 334 4.2 4.23 2.63 ## 5 0.31 Good J SI2 63.3 58 335 4.34 4.35 2.75 ## 6 0.24 Very Good J VVS2 62.8 57 336 3.94 3.96 2.48 ## 7 0.24 Very Good I VVS1 62.3 57 336 3.95 3.98 2.47 ## 8 0.26 Very Good H SI1 61.9 55 337 4.07 4.11 2.53 ## 9 0.22 Fair E VS2 65.1 61 337 3.87 3.78 2.49 ## 10 0.23 Very Good H VS1 59.4 61 338 4 4.05 2.39 ## # â€¦ with 53,930 more rows plot_ly(diamonds, x = ~cut) plot_ly(diamonds, x = ~cut, y = ~clarity) plot_ly(diamonds, x = ~cut, color = ~clarity, colors = &quot;Accent&quot;) 4.2.2 easy to add trace p &lt;- diamonds %&gt;% plot_ly(x = ~cut) %&gt;% add_histogram(name = &quot;hist&quot;) %&gt;% group_by(cut) %&gt;% summarise(n = n()) %&gt;% add_text( text = ~scales::comma(n), y = ~n, textposition = &quot;top middle&quot;, cliponaxis = FALSE, name = &quot;text&quot; ) %&gt;% ungroup() %&gt;% mutate(avg = mean(n)) %&gt;% add_lines(y = ~avg, opacity = 0.8, line =list(width=2), name = &quot;avg&quot; ) p 4.2.3 getting raw data p %&gt;% plotly_data() ## # A tibble: 5 Ã— 3 ## cut n avg ## &lt;ord&gt; &lt;int&gt; &lt;dbl&gt; ## 1 Fair 1610 10788 ## 2 Good 4906 10788 ## 3 Very Good 12082 10788 ## 4 Premium 13791 10788 ## 5 Ideal 21551 10788 4.2.4 publishing output saveWidget(p, &quot;p.html&quot;, selfcontained = F, libdir = &quot;lib&quot;) 4.3 Plotly Foundations æ­£å¦‚æˆ‘ä»¬åœ¨ç¬¬2èŠ‚ä¸­æ‰€çœ‹åˆ°çš„ï¼Œä¸€ä¸ªplotlyå›¾åƒç”±å¤šæ¡traceç»„æˆï¼Œæ¯ç§traceå¯¹åº”ä¸€ä¸ªç”»å›¾ç±»å‹ï¼Œä¾‹å¦‚ï¼Œç‚¹ã€çº¿ã€æ–‡æœ¬å’Œå¤šè¾¹å½¢ï¼Œä¸R base plot å’Œ ggplot2ç±»ä¼¼ã€‚è¿™äº›traceé€šè¿‡add_trace()æˆ–add_*()å‡½æ•°ï¼ˆadd_markers(), add_lines(), add_paths(), add_segments(), add_ribbons(), add_area(), and add_polygons()ç­‰ï¼‰æ¥åˆ›å»ºã€‚ 4.3.1 markers # load the mpg dataset from the ggplot2 package data(mpg, package = &quot;ggplot2&quot;) mpg ## # A tibble: 234 Ã— 11 ## manufacturer model displ year cyl trans drv cty hwy fl class ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; ## 1 audi a4 1.8 1999 4 autoâ€¦ f 18 29 p compâ€¦ ## 2 audi a4 1.8 1999 4 manuâ€¦ f 21 29 p compâ€¦ ## 3 audi a4 2 2008 4 manuâ€¦ f 20 31 p compâ€¦ ## 4 audi a4 2 2008 4 autoâ€¦ f 21 30 p compâ€¦ ## 5 audi a4 2.8 1999 6 autoâ€¦ f 16 26 p compâ€¦ ## 6 audi a4 2.8 1999 6 manuâ€¦ f 18 26 p compâ€¦ ## 7 audi a4 3.1 2008 6 autoâ€¦ f 18 27 p compâ€¦ ## 8 audi a4 quattro 1.8 1999 4 manuâ€¦ 4 18 26 p compâ€¦ ## 9 audi a4 quattro 1.8 1999 4 autoâ€¦ 4 16 25 p compâ€¦ ## 10 audi a4 quattro 2 2008 4 manuâ€¦ 4 20 28 p compâ€¦ ## # â€¦ with 224 more rows 4.3.1.1 Alpha plot_ly(mpg, x = ~cty, y = ~hwy) %&gt;% add_markers(alpha = 0.3) 4.3.1.2 Colors discrete plot_ly(mpg, x = ~cty, y = ~hwy) %&gt;% add_markers(color = ~factor(cyl)) continuous plot_ly(mpg, x = ~cty, y = ~hwy) %&gt;% add_markers(color = ~cyl) %&gt;% colorbar() no mapping data values plot_ly(mpg, x = ~cty, y = ~hwy) %&gt;% add_markers(color = I(&quot;black&quot;)) 4.3.1.3 Symbols plot_ly(mpg, x = ~cty, y = ~hwy) %&gt;% add_markers(symbol = ~factor(cyl)) 4.3.1.4 Size plot_ly(mpg, x = ~cty, y = ~hwy, alpha = 0.3) %&gt;% add_markers(size = ~cyl) 4.3.2 Lines # load the txhousing dataset from the ggplot2 package data(txhousing, package = &quot;ggplot2&quot;) txhousing ## # A tibble: 8,602 Ã— 9 ## city year month sales volume median listings inventory date ## &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Abilene 2000 1 72 5380000 71400 701 6.3 2000 ## 2 Abilene 2000 2 98 6505000 58700 746 6.6 2000. ## 3 Abilene 2000 3 130 9285000 58100 784 6.8 2000. ## 4 Abilene 2000 4 98 9730000 68600 785 6.9 2000. ## 5 Abilene 2000 5 141 10590000 67300 794 6.8 2000. ## 6 Abilene 2000 6 156 13910000 66900 780 6.6 2000. ## 7 Abilene 2000 7 152 12635000 73500 742 6.2 2000. ## 8 Abilene 2000 8 131 10710000 75000 765 6.4 2001. ## 9 Abilene 2000 9 104 7615000 64500 771 6.5 2001. ## 10 Abilene 2000 10 101 7040000 59300 764 6.6 2001. ## # â€¦ with 8,592 more rows 4.3.2.1 Linetypes top5 &lt;- txhousing %&gt;% group_by(city) %&gt;% summarise(avg = mean(sales, na.rm = TRUE)) %&gt;% arrange(desc(avg)) %&gt;% top_n(5) tx5 &lt;- semi_join(txhousing, top5, by = &quot;city&quot;) plot_ly(tx5, x = ~date, y = ~median) %&gt;% add_lines(linetype = ~city) 4.3.3 Bars &amp; histograms p1 &lt;- plot_ly(diamonds, x = ~price) %&gt;% add_histogram() p2 &lt;- plot_ly(diamonds, x = ~cut) %&gt;% add_histogram() subplot(p1, p2) %&gt;% hide_legend() Multiple numeric distributions one_plot &lt;- function(d) { plot_ly(d, x = ~price) %&gt;% add_histogram() %&gt;% add_annotations( ~unique(clarity), x = 0.5, y = 1, xref = &quot;paper&quot;, yref = &quot;paper&quot;, showarrow = FALSE ) } diamonds %&gt;% split(.$clarity) %&gt;% lapply(one_plot) %&gt;% subplot(nrows = 2, shareX = TRUE, titleX = FALSE) %&gt;% hide_legend() Multiple discrete distributions plot_ly(diamonds, x = ~cut, color = ~clarity) %&gt;% add_histogram() percent # number of diamonds by cut and clarity (n) cc &lt;- count(diamonds, cut, clarity) # number of diamonds by cut (nn) cc2 &lt;- left_join(cc, count(cc, cut, wt = n, name = &#39;nn&#39;)) cc2 %&gt;% mutate(prop = n / nn) %&gt;% plot_ly(x = ~cut, y = ~prop, color = ~clarity) %&gt;% add_bars() %&gt;% layout(barmode = &quot;stack&quot;) 4.3.4 Boxplots p &lt;- plot_ly(diamonds, y = ~price, color = I(&quot;black&quot;), alpha = 0.1, boxpoints = &quot;suspectedoutliers&quot;) p1 &lt;- p %&gt;% add_boxplot(x = &quot;Overall&quot;) p2 &lt;- p %&gt;% add_boxplot(x = ~cut) subplot( p1, p2, shareY = TRUE, widths = c(0.2, 0.8), margin = 0 ) %&gt;% hide_legend() d &lt;- diamonds %&gt;% mutate(cc = interaction(clarity, cut)) # interaction levels sorted by median price lvls &lt;- d %&gt;% group_by(cc) %&gt;% summarise(m = median(price)) %&gt;% arrange(m) %&gt;% pull(cc) plot_ly(d, x = ~price, y = ~factor(cc, lvls)) %&gt;% add_boxplot(color = ~clarity) %&gt;% layout(yaxis = list(title = &quot;&quot;)) 4.4 Plotly Advanced 4.4.1 ggplotly data(&quot;iris&quot;) one_ggplot &lt;- function(i = 1){ themr &lt;- ggthemr(palette[i], set_theme = FALSE) p &lt;- iris %&gt;% ggplot(aes(Sepal.Length, fill = Species)) + geom_histogram(binwidth = 0.2) + get_ggthemr_color(palette = palette[i], return_type = &quot;fill&quot;) + themr$theme return(p) } one_ggplot() one_ggplot() %&gt;% ggplotly() 4.4.2 layout title_font &lt;- list(color = &quot;white&quot;, size = 26, family = &quot;Microsoft YaHei&quot;) axis_font &lt;- list(color = &quot;white&quot;, size = 20, family = &quot;Microsoft YaHei&quot;) plot_ly(mpg, x = ~cty, y = ~hwy) %&gt;% add_markers(color = ~factor(cyl)) %&gt;% layout( title = list( text = paste(&#39;markers-dark-theme&#39;), font = title_font ), showlegend = TRUE, legend = list(font = list(color = &#39;white&#39;)), yaxis = list( tickmode=&#39;array&#39;, autorange = TRUE, showgrid = FALSE, title = list(text = &#39;cty&#39;) , showline = TRUE, color = &#39;white&#39;, font = axis_font, nticks = 4 ), xaxis = list( showline = TRUE, title = list(text = &#39;hwy&#39;), color = &#39;white&#39;, font = axis_font ), paper_bgcolor = &quot;#000000&quot;, plot_bgcolor = &quot;#000000&quot;, margin = list( t = 90, b = 90, l = 90, r = 90 ) ) 4.4.3 Javascript plotly_hover, plotly_click, plotly_selected example 1 p &lt;- plot_ly(mtcars, x = ~wt, y = ~mpg) %&gt;% add_markers( text = rownames(mtcars), customdata = paste0(&quot;https://www.bing.com/search?q=&quot;, rownames(mtcars)) ) onRender( p, &quot; function(el) { el.on(&#39;plotly_click&#39;, function(d) { var url = d.points[0].customdata; window.open(url); }); } &quot;) Click ğŸ‘† example 2 nms &lt;- names(mtcars) p &lt;- plot_ly(colors = &quot;RdBu&quot;) %&gt;% add_heatmap( x = nms, y = nms, z = ~round(cor(mtcars), 3) ) %&gt;% onRender(&quot; function(el) { Plotly.d3.json(&#39;mtcars.json&#39;, function(mtcars) { el.on(&#39;plotly_click&#39;, function(d) { var x = d.points[0].x; var y = d.points[0].y; var trace = { x: mtcars[x], y: mtcars[y], mode: &#39;markers&#39; }; Plotly.newPlot(&#39;filtered-plot&#39;, [trace]); }); }); } &quot;) # In a temporary directory, save the mtcars dataset as json and # the html to an test.html file, then open via a web server withr::with_path(tempdir(), { jsonlite::write_json(as.list(mtcars), &quot;mtcars.json&quot;) html &lt;- tagList(p, tags$div(id = &#39;filtered-plot&#39;)) save_html(html, &quot;mtcars.html&quot;) # if (interactive()) servr::httd() }) Click ğŸ‘‡ "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
